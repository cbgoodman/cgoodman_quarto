{"title":"Maps in R using {urbnmapr}","markdown":{"yaml":{"title":"Maps in R using {urbnmapr}","date":"2018-06-16","categories":["r","dataviz","maps"],"aliases":["/2018/06/16/maps-in-r-urbnmapr/"]},"headingText":"Installation","containsRefs":false,"markdown":"\n\nThe Urban Institute has released a new package for mapping state and county data in **R**, `urbnmapr`. Their posts can be found [here](https://medium.com/@urban_institute/how-to-create-state-and-county-maps-easily-in-r-577d29300bb2) and\n[here](https://ui-research.github.io/r-at-urban/mapping.html). Since I occasionally write about how to make simple maps in **R**, I am going to quickly go from start to finish on making a county map.\n\nInstallation is easy. The library is hosted on Urban's [GitHub](https://github.com/UrbanInstitute/urbnmapr) page. Installing **R** packages from non-CRAN sources requires the `devtools` package.\n\n```R\nrequire(\"devtools\")\ndevtools::install_github(“UrbanInstitute/urbnmapr”)\n```\n\n## Example\nLet's dive into any example. Since my last [Maps in R](https://www.cgoodman.com/2017/02/14/maps-in-library%28maps%29-updated/) post used data on the [Metropolitan Power Diffusion Index](http://www.metrostudies.pitt.edu/Projects/Metropolitan-Power-Diffusion-Index) for special districts from year 2012, we'll use the same data. The base data comes from the [2012 Census of Governments](http://www.census.gov/govs/cog/)\n\n`urbnmapr` is a package to map states and/or counties in `ggplot2` so for simplicity sake, we'll load the entire `tidyverse` library. We'll need to load `dplyr` for the join anyways. I have loaded the `viridis` library to gain access to the [Viridis color scale](https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html). This isn't necessary, but I like the color options.\n\nTo add the MPDI data to the `urbnmapr` data, `left_join()` from the `dplyr` package is used. One thing to pay close attention to is this requires the joining data to be of the same class. `county_fips` in `urbnmapr::counties` is of class character; hence, my import of the county FIPS variable as \"character\".\n\n<!---required packages and data import--->\n```R\nlibrary(\"tidyverse\")\nlibrary(\"viridis\")\nlibrary(\"urbnmapr\")\n\n# Add data\nmpdi <- read.csv(\"mpdi.csv\", header=TRUE, sep=\",\",\n        quote=\"\\\"\", colClass=c(\"character\", \"numeric\"))\n# Join with urbnmapr\nmpdi.data <- left_join(mpdi, counties, by = \"county_fips\")\n```\n\nWith the data imported and joined, I next define some cut points in the data. This step isn't strictly necessary depending on your data (`ggplot2` will attempt to map any numerical data on a continuous scale). For these data, defining some cut points makes for a more meaningful map.\n\n<!---create quantiles--->\n```R\n# Create quantiles\nno_classes <- 6\nlabels <- c()\nquantiles <- quantile(mpdi.data$mpdi,\n                      probs = seq(0, 1, length.out = no_classes + 1))\n# Custom labels, rounding\nlabels <- c()\nfor(idx in 1:length(quantiles)){\n  labels <- c(labels, paste0(round(quantiles[idx], 2),\n  \" – \",\n  round(quantiles[idx + 1], 2)))\n}\n# Minus one label to remove the odd ending one\nlabels <- labels[1:length(labels)-1]\n\n# Create new variable for fill\nmpdi.data$mpdi.quantiles <- cut(mpdi.data$mpdi,\n  breaks = quantiles,\n  labels = labels,\n  include.lowest = T)\n```\n\nFrom here, we plot! If you're at all familiar with `ggplot2`, this should look very familiar. The two `geom_polygon` lines define the filled county map and the state outline map. `coord_map()` defines the map projection. Urban's post uses the Albers projection, but I happen to like the polyconic projection and that's what is used here. `coord_map()` can use any projection in the `mapproj` package so the choice of projection is up to you. `scale_fill_viridis()` uses the `virdis` library to assign colors. I have reversed the usual color scale and trimmed off the top color (`end=0.9`, bright yellow). The remainder of the code is theming. I remove all the axis labels and coloring, change the default font, and move the legend around.  \n\n<!---plot!--->\n```R\nggplot() +\n  # County map\n  geom_polygon(data = mpdi.data,\n    mapping = aes(x = long, y = lat,\n      group = group,\n      fill = mpdi.data$mpdi.quantiles)) +\n  # Add state outlines\n  geom_polygon(data = urbnmapr::states,\n    mapping = aes(long, lat,group = group),\n    fill = NA, color = \"#ffffff\", size = 0.4) +\n  # Projection\n  coord_map(projection = \"polyconic\")+\n  # Fill color\n  scale_fill_viridis(\n    option = \"viridis\",\n    name = \"Metropolitan Power Diffusion Index\",\n    discrete = T,\n    direction = -1,\n    end=0.9,\n    guide = guide_legend(\n      keyheight = unit(5, units = \"mm\"),\n      title.position = 'top',\n      reverse = F)\n    )+\n  # Theming\n  theme_minimal(base_family = \"Open Sans Condensed Light\")+\n  theme(\n    legend.position = \"bottom\",\n    legend.text.align = 0,\n    plot.margin = unit(c(.5,.5,.2,.5), \"cm\")) +\n  theme(\n    axis.line = element_blank(),\n    axis.text.x = element_blank(),\n    axis.text.y = element_blank(),\n    axis.ticks = element_blank(),\n    axis.title.x = element_blank(),\n    axis.title.y = element_blank(),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    )+\n  theme(plot.title=element_text(family=\"Open Sans Condensed Bold\", margin=margin(b=15)))+\n  theme(plot.subtitle=element_text(family=\"Open Sans Condensed Light Italic\"))+\n  theme(plot.margin=unit(rep(0.5, 4), \"cm\"))+\n  labs(x = \"\",\n       y = \"\",\n       title = \"Example map using the Data@Urban `urbnmapr'\",\n       subtitle = \"Metropolitan Power Diffusion Index, Special Districts 2012\",\n       caption = \"Author: Chris Goodman (@cbgoodman), Data: U.S. Census Bureau Census of Governments\")\n```\n\n## Final Product\nThe final product is sharp looking. Certainly web-ready and with a little more work is likely print-ready. As I move all my graphics production to `ggplot2`, `urbnmapr` is my new go-to for simple state or county mapping. It won't replace more complex operations requiring shapefiles, but it will reduce the amount of time and effort it takes to make simple maps.\n\n::: {.column-page}\n![Metropolitan Power Diffusion Index, 2012. Normally, Alaska would be included, but the original MPDI data file did not and I did not update it.](../../files/img/mpdi_urbnmapr.png){fig-align=\"center\"}\n:::\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"github","toc":true,"toc-depth":4,"output-file":"2018-06-16-maps-in-r-urbnmapr.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.38","author-meta":"Christopher B. Goodman","_quarto-vars":{"years":"2013–2022","orcid":"0000-0002-8565-9714","github-url":"https://github.com/cbgoodman/"},"theme":{"light":["cosmo","../../html/style.scss"],"dark":["../../html/style-dark.scss"]},"code-block-bg":false,"date-format":"MMMM D, YYYY","title-block-banner":"#3D5266","toc-title":"Contents","toc-location":"left","author":[{"name":"Christopher B. Goodman","url":"https://www.cgoodman.com","orcid":"0000-0002-8565-9714"}],"quarto-template-params":{"banner-header-class":"blog-post"},"title":"Maps in R using {urbnmapr}","date":"2018-06-16","categories":["r","dataviz","maps"],"aliases":["/2018/06/16/maps-in-r-urbnmapr/"]},"extensions":{"book":{"multiFile":true}}}}}